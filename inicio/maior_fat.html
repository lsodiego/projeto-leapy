<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_mf.css"/>
    <title>Visualizador de Dados da Planilha</title>
    </head>
<body>

    <h1>Dados da Sua Planilha Google</h1>

    <button id="loadDataBtn">Carregar Dados da Planilha</button>

    <div id="tabelaContainer">
        </div>

    <script>
        document.getElementById('loadDataBtn').addEventListener('click', function() {
            // URL da sua planilha publicada como CSV (já fornecida por você)
            const urlPlanilhaPublicadaCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRIfu_bkc8cu1dNbItO9zktGmn4JjNjQEoLAzGcG9rZDyfDyDp4ISEqpPKzIFTWFrMNVIz05V3NTpGT/pub?gid=2052374642&single=true&output=csv';

            const tabelaContainer = document.getElementById('tabelaContainer');
            tabelaContainer.innerHTML = '<p class="loading-message">Carregando dados...</p>';

            fetch(urlPlanilhaPublicadaCSV)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Erro ao buscar a planilha. Status: ${response.status}. Verifique se a URL está correta e se a planilha continua publicada como CSV.`);
                    }
                    return response.text(); // Pega o conteúdo do CSV como texto
                })
                .then(csvText => {
                    tabelaContainer.innerHTML = ''; // Limpa a mensagem de "Carregando"
                    const table = document.createElement('table');
                    const rows = csvText.trim().split(/\r?\n/); // Divide o texto CSV em linhas (lida com \n e \r\n)

                    if (rows.length === 0 || (rows.length === 1 && rows[0].trim() === '')) {
                        tabelaContainer.innerHTML = '<p class="error-message">Nenhum dado encontrado na planilha publicada ou a planilha está vazia.</p>';
                        return;
                    }

                    // Cria o cabeçalho da tabela (thead)
                    const thead = table.createTHead();
                    const headerRow = thead.insertRow();
                    // Assume que a primeira linha do CSV são os cabeçalhos
                    const headers = parseCSVRow(rows[0]);
                    headers.forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText.trim();
                        headerRow.appendChild(th);
                    });

                    // Cria o corpo da tabela (tbody)
                    const tbody = table.createTBody();
                    for (let i = 1; i < rows.length; i++) { // Começa da segunda linha para os dados
                        if (rows[i].trim() === '') continue; // Pula linhas em branco
                        
                        const dataCells = parseCSVRow(rows[i]);
                        const tr = tbody.insertRow();
                        dataCells.forEach(cellText => {
                            const td = tr.insertCell();
                            td.textContent = cellText.trim();
                        });
                    }
                    tabelaContainer.appendChild(table);
                })
                .catch(error => {
                    console.error('Erro ao carregar ou processar os dados da planilha:', error);
                    tabelaContainer.innerHTML = `<p class="error-message">Falha ao carregar dados: ${error.message}</p>`;
                });
        });

        // Função auxiliar para parsear uma linha CSV.
        // Lida com campos entre aspas que podem conter vírgulas.
        function parseCSVRow(rowString) {
            const result = [];
            let currentField = '';
            let inQuotes = false;
            for (let i = 0; i < rowString.length; i++) {
                const char = rowString[i];
                if (char === '"') {
                    // Se a próxima aspa é uma aspa dupla (escape), adiciona uma aspa ao campo
                    if (inQuotes && i + 1 < rowString.length && rowString[i+1] === '"') {
                        currentField += '"';
                        i++; // Pula a segunda aspa do par de escape
                    } else {
                        inQuotes = !inQuotes; // Alterna o estado de estar dentro/fora das aspas
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(currentField);
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            result.push(currentField); // Adiciona o último campo
            return result; // Não faz trim aqui, pois pode ser importante para alguns dados
        }
    </script>

    <div class="container">
        <a href="../inicio/index.html" class="action-button">Voltar ao Início</a>
        </div>

</body>
</html>