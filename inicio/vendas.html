<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_vendas.css"/>
    <title>Visualizador de Dados da Planilha</title>
    </head>
<body>

    <h1>Dados da Sua Planilha Google</h1>

    <button id="loadDataBtn">Carregar Dados da Planilha</button>

    <div id="tabelaContainer">
        </div>

    <script>
        document.getElementById('loadDataBtn').addEventListener('click', function() {
            // URL da sua planilha publicada como CSV
            const urlPlanilhaPublicadaCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRIfu_bkc8cu1dNbItO9zktGmn4JjNjQEoLAzGcG9rZDyfDyDp4ISEqpPKzIFTWFrMNVIz05V3NTpGT/pub?gid=0&single=true&output=csv';

            const tabelaContainer = document.getElementById('tabelaContainer');
            tabelaContainer.innerHTML = '<p class="loading-message">Carregando dados...</p>';

            fetch(urlPlanilhaPublicadaCSV)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Erro ao buscar a planilha. Status: ${response.status}. Verifique se a URL está correta e se a planilha continua publicada como CSV.`);
                    }
                    return response.text();
                })
                .then(csvText => {
                    tabelaContainer.innerHTML = '';
                    const table = document.createElement('table');
                    const rows = csvText.trim().split(/\r?\n/);

                    if (rows.length === 0 || (rows.length === 1 && rows[0].trim() === '')) {
                        tabelaContainer.innerHTML = '<p class="error-message">Nenhum dado encontrado na planilha publicada ou a planilha está vazia.</p>';
                        return;
                    }

                    const thead = table.createTHead();
                    const headerRow = thead.insertRow();
                    const headers = parseCSVRow(rows[0]);
                    headers.forEach(headerText => {
                        const th = document.createElement('th');
                        th.textContent = headerText.trim();
                        headerRow.appendChild(th);
                    });

                    const tbody = table.createTBody();
                    for (let i = 1; i < rows.length; i++) {
                        if (rows[i].trim() === '') continue;
                        
                        const dataCells = parseCSVRow(rows[i]);
                        const tr = tbody.insertRow();
                        dataCells.forEach(cellText => {
                            const td = tr.insertCell();
                            td.textContent = cellText.trim();
                        });
                    }
                    tabelaContainer.appendChild(table);
                })
                .catch(error => {
                    console.error('Erro ao carregar ou processar os dados da planilha:', error);
                    tabelaContainer.innerHTML = `<p class="error-message">Falha ao carregar dados: ${error.message}</p>`;
                });
        });

        function parseCSVRow(rowString) {
            const result = [];
            let currentField = '';
            let inQuotes = false;
            for (let i = 0; i < rowString.length; i++) {
                const char = rowString[i];
                if (char === '"') {
                    if (inQuotes && i + 1 < rowString.length && rowString[i+1] === '"') {
                        currentField += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(currentField);
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            result.push(currentField);
            return result;
        }
    </script>

    <div class="container">
        <a href="../inicio/index.html" class="action-button">Voltar ao Início</a>
        </div>

</body>
</html>
